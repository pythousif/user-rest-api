import speech_recognition as sr
import pyttsx3
import threading
from tkinter import Tk, Label
from PIL import Image, ImageTk
import time

# ========== SETUP ==========
WAKE_WORD = "jarvis"
GIF_PATH = "ai_animation.gif"  # Ensure this file exists in same folder
running = True

# ========== TTS ENGINE ==========
engine = pyttsx3.init()
engine.setProperty('rate', 150)

def speak(text):
    print(f"üó£ Speaking: {text}")
    engine.say(text)
    engine.runAndWait()

# ========== ANIMATION ==========
def show_gif_animation():
    def animate():
        frame_index = 0
        while running:
            frame = frames[frame_index]
            gif_label.configure(image=frame)
            window.update_idletasks()
            frame_index = (frame_index + 1) % len(frames)
            time.sleep(0.1)
    try:
        gif = Image.open(GIF_PATH)
        frames = []
        try:
            while True:
                frame = ImageTk.PhotoImage(gif.copy().convert("RGBA"))
                frames.append(frame)
                gif.seek(len(frames))
        except EOFError:
            pass

        window = Tk()
        window.title("JARVIS - AI Assistant")
        window.geometry("500x500")
        gif_label = Label(window)
        gif_label.pack()

        threading.Thread(target=animate, daemon=True).start()
        threading.Thread(target=window.mainloop, daemon=True).start()

    except Exception as e:
        print("‚ùå GIF error:", e)

# ========== LISTEN FUNCTION ==========
def listen():
    r = sr.Recognizer()
    with sr.Microphone() as source:
        print("üé§ Listening...")
        audio = r.listen(source)
        try:
            query = r.recognize_google(audio, language='en-in')
            print("üîç Recognizing:", query)
            return query.lower()
        except sr.UnknownValueError:
            return ""
        except sr.RequestError:
            speak("Network error.")
            return ""

# ========== COMMAND HANDLER ==========
def handle_command(command):
    if "news" in command:
        speak("Aaj ki taaza khabar: AI duniya ko badal raha hai!")
    elif "stop" in command:
        speak("Goodbye!")
        global running
        running = False
    else:
        speak("Mujhe yeh samajh nahi aaya.")

# ========== MAIN ==========
def main():
    speak("Hello, I am Jarvis. Say 'Jarvis' to activate me.")
    show_gif_animation()

    while running:
        print("üïí Waiting for wake word 'Jarvis'...")
        text = listen()
        if WAKE_WORD in text:
            speak("Yes, how can I help you?")
            command = listen()
            handle_command(command)

if __name__ == "__main__":
    main()
